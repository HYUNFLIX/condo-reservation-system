<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ - ë²•ì¸ì½˜ë„ ì˜ˆì•½ ì‹œìŠ¤í…œ</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8'
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    
    <!-- Chart.js for í†µê³„ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <style>
        .admin-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .admin-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-selected {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-rejected {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .status-cancelled {
            background: #f3f4f6;
            color: #374151;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.6s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .modal-enter {
            animation: modalEnter 0.3s ease-out;
        }
        
        @keyframes modalEnter {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .search-highlight {
            background: yellow;
            font-weight: bold;
        }
        
        .admin-table {
            font-size: 14px;
        }
        
        .admin-table th {
            background: #f8fafc;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .admin-table tr:hover {
            background: #f8fafc;
        }
        
        .btn-loading {
            position: relative;
        }
        
        .btn-loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            margin: -8px 0 0 -8px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .stats-card.green {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
        }
        
        .stats-card.orange {
            background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
        }
        
        .stats-card.red {
            background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }

        .auth-required {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-indigo-50">
    <!-- ë¡œë”© í™”ë©´ -->
    <div id="loading-screen" class="min-h-screen flex items-center justify-center">
        <div class="text-center">
            <svg class="animate-spin h-12 w-12 text-blue-600 mx-auto mb-4" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="text-gray-600 text-lg">ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...</p>
        </div>
    </div>

    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="login-screen" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md">
            <!-- ë¡œê·¸ì¸ ë©”ì‹œì§€ ì˜ì—­ -->
            <div id="login-success" class="hidden bg-green-500 text-white p-3 rounded-xl mb-4 text-sm">
                <div class="flex items-center gap-2">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <span id="login-success-text">ë¡œê·¸ì¸ ì„±ê³µ!</span>
                </div>
            </div>

            <div id="login-error" class="hidden bg-red-500 text-white p-3 rounded-xl mb-4 text-sm">
                <div class="flex items-center gap-2">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                    </svg>
                    <span id="login-error-text">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>
                </div>
            </div>
            
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z" clip-rule="evenodd"/>
                    </svg>
                </div>
                <h1 class="text-2xl font-bold text-gray-900 mb-2">ê´€ë¦¬ì ë¡œê·¸ì¸</h1>
                <p class="text-gray-600">ë²•ì¸ì½˜ë„ ì˜ˆì•½ ì‹œìŠ¤í…œ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">ì´ë©”ì¼</label>
                    <input type="email" 
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors" 
                           id="admin-email" 
                           placeholder="ê´€ë¦¬ì ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" 
                           value="admin@company.com">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" 
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors" 
                           id="admin-password" 
                           placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                
                <button id="login-btn" 
                        class="w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all duration-300 transform hover:-translate-y-1">
                    <span id="login-text">ë¡œê·¸ì¸</span>
                </button>
            </div>
            
            <!-- ê´€ë¦¬ì ê³„ì • ìƒì„± ì•ˆë‚´
            <div class="mt-6 p-4 auth-required rounded-xl">
                <h4 class="font-semibold text-gray-800 mb-2">âš ï¸ ìµœì´ˆ ì„¤ì • í•„ìš”</h4>
                <p class="text-sm text-gray-700 mb-3">
                    ê´€ë¦¬ì ê³„ì •ì´ ì—†ëŠ” ê²½ìš°, ë¨¼ì € ê³„ì •ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.
                </p>
                <button id="create-admin-btn" 
                        class="w-full py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm font-semibold rounded-lg transition-colors">
                    ê´€ë¦¬ì ê³„ì • ìƒì„±
                </button>
            </div>
            
            <div class="mt-4 text-center">
                <p class="text-sm text-gray-500">
                    ê°œë°œ/í…ŒìŠ¤íŠ¸ìš©: admin@company.com
                </p>
            </div>
        </div>
    </div>
     -->

    <!-- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ -->
    <div id="admin-dashboard" class="hidden">
        <!-- í—¤ë” -->
        <div class="bg-gradient-to-r from-blue-600 via-blue-700 to-indigo-700 text-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-6">
                    <div>
                        <h1 class="text-3xl font-bold">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
                        <p class="text-blue-100 mt-1">2025ë…„ í•˜ê³„ì„±ìˆ˜ê¸° ë²•ì¸ì½˜ë„ ì˜ˆì•½ ê´€ë¦¬</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <!-- Firebase ìƒíƒœ í‘œì‹œ -->
                        <div id="firebase-status-indicator" class="flex items-center gap-2 text-sm">
                            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                            <span class="text-blue-100">Firebase ì—°ê²°ë¨</span>
                        </div>
                        
                        <div class="text-sm text-blue-100">
                            <div class="font-semibold" id="admin-email-display">ê´€ë¦¬ì</div>
                            <div id="current-time"></div>
                        </div>
                        <button id="logout-btn" 
                                class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg font-semibold transition-all">
                            ë¡œê·¸ì•„ì›ƒ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
            <div id="admin-success" class="hidden bg-green-500 text-white p-4 rounded-xl mb-6 fade-in">
                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <span id="admin-success-text">ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</span>
                </div>
            </div>

            <div id="admin-error" class="hidden bg-red-500 text-white p-4 rounded-xl mb-6 fade-in">
                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                    </svg>
                    <span id="admin-error-text">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>
                </div>
            </div>

            <!-- í†µê³„ ì¹´ë“œ -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="stats-card text-white rounded-2xl p-6 admin-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-100 text-sm">ì „ì²´ ì‹ ì²­</p>
                            <p class="text-3xl font-bold" id="total-applications">0</p>
                        </div>
                        <svg class="w-10 h-10 text-blue-200" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                </div>

                <div class="stats-card green text-white rounded-2xl p-6 admin-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-sm">ë‹¹ì²¨ì</p>
                            <p class="text-3xl font-bold" id="selected-applications">0</p>
                        </div>
                        <svg class="w-10 h-10 text-green-200" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                </div>

                <div class="stats-card orange text-white rounded-2xl p-6 admin-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-orange-100 text-sm">ëŒ€ê¸° ì¤‘</p>
                            <p class="text-3xl font-bold" id="pending-applications">0</p>
                        </div>
                        <svg class="w-10 h-10 text-orange-200" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                </div>

                <div class="stats-card red text-white rounded-2xl p-6 admin-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-100 text-sm">íƒˆë½ì</p>
                            <p class="text-3xl font-bold" id="rejected-applications">0</p>
                        </div>
                        <svg class="w-10 h-10 text-red-200" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- ì°¨íŠ¸ ì„¹ì…˜ -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="bg-white rounded-2xl shadow-lg p-6 admin-card">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">ì½˜ë„ë³„ ì‹ ì²­ í˜„í™©</h3>
                    <div class="chart-container">
                        <canvas id="condoChart"></canvas>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-lg p-6 admin-card">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">ì¼ë³„ ì‹ ì²­ í˜„í™©</h3>
                    <div class="chart-container">
                        <canvas id="dateChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- ì œì–´ íŒ¨ë„ -->
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-8 admin-card">
                <h3 class="text-xl font-bold text-gray-800 mb-6">ì¶”ì²¨ ê´€ë¦¬</h3>
                <div class="flex flex-wrap gap-4">
                    <button id="auto-draw-btn" 
                            class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-6 py-3 rounded-xl font-semibold transition-all transform hover:-translate-y-1">
                        <div class="flex items-center gap-2">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                            </svg>
                            ìë™ ì¶”ì²¨ ì‹¤í–‰
                        </div>
                    </button>
                    
                    <button id="export-btn" 
                            class="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white px-6 py-3 rounded-xl font-semibold transition-all transform hover:-translate-y-1">
                        <div class="flex items-center gap-2">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                            Excel ë‹¤ìš´ë¡œë“œ
                        </div>
                    </button>
                    
                    <button id="reset-draw-btn" 
                            class="bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 text-white px-6 py-3 rounded-xl font-semibold transition-all transform hover:-translate-y-1">
                        <div class="flex items-center gap-2">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" clip-rule="evenodd"/>
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                            </svg>
                            ì¶”ì²¨ ê²°ê³¼ ì´ˆê¸°í™”
                        </div>
                    </button>

                    <button id="backup-btn" 
                            class="bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-700 hover:to-blue-700 text-white px-6 py-3 rounded-xl font-semibold transition-all transform hover:-translate-y-1">
                        <div class="flex items-center gap-2">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm3 5a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1z"/>
                            </svg>
                            ë°ì´í„° ë°±ì—…
                        </div>
                    </button>
                </div>
            </div>

            <!-- ì‹ ì²­ ëª©ë¡ -->
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden admin-card">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                        <h3 class="text-xl font-bold text-gray-800">ì‹ ì²­ ëª©ë¡ ê´€ë¦¬</h3>
                        
                        <!-- ê²€ìƒ‰ ë° í•„í„° -->
                        <div class="flex flex-col sm:flex-row gap-3">
                            <div class="relative">
                                <input type="text" 
                                       placeholder="ê²€ìƒ‰ (ì´ë¦„, ì‚¬ë²ˆ, ì½˜ë„ëª…)" 
                                       class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none w-full sm:w-64"
                                       id="search-input">
                                <svg class="w-5 h-5 text-gray-400 absolute left-3 top-2.5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            
                            <select id="status-filter" 
                                    class="px-4 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                                <option value="">ì „ì²´ ìƒíƒœ</option>
                                <option value="pending">ëŒ€ê¸° ì¤‘</option>
                                <option value="selected">ë‹¹ì²¨</option>
                                <option value="rejected">íƒˆë½</option>
                                <option value="cancelled">ì·¨ì†Œ</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="overflow-x-auto max-h-96">
                    <table class="w-full admin-table">
                        <thead>
                            <tr class="border-b border-gray-200">
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                    <input type="checkbox" id="select-all" class="rounded">
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">ì‹ ì²­ì</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">ì½˜ë„ëª…</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">ë‚ ì§œ</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">ìƒíƒœ</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">ì‹ ì²­ì¼</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">ì•¡ì…˜</th>
                            </tr>
                        </thead>
                        <tbody id="applications-table">
                            <!-- ë™ì  ìƒì„± -->
                        </tbody>
                    </table>
                </div>
                
                <!-- ì¼ê´„ ì•¡ì…˜ -->
                <div id="bulk-actions" class="hidden p-4 bg-gray-50 border-t">
                    <div class="flex flex-wrap gap-3">
                        <button class="bulk-action-btn bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium" 
                                data-action="selected">
                            ì„ íƒí•œ í•­ëª© ë‹¹ì²¨ ì²˜ë¦¬
                        </button>
                        <button class="bulk-action-btn bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium" 
                                data-action="rejected">
                            ì„ íƒí•œ í•­ëª© íƒˆë½ ì²˜ë¦¬
                        </button>
                        <button class="bulk-action-btn bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm font-medium" 
                                data-action="pending">
                            ì„ íƒí•œ í•­ëª© ëŒ€ê¸° ìƒíƒœë¡œ ë³€ê²½
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì‹ ì²­ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
    <div id="detail-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto modal-enter">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold text-gray-900">ì‹ ì²­ ìƒì„¸ ì •ë³´</h3>
                    <button id="detail-modal-close" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <div id="detail-content">
                    <!-- ë™ì  ë‚´ìš© -->
                </div>
                
                <div class="mt-6 flex gap-3">
                    <select id="detail-status" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg">
                        <option value="pending">ëŒ€ê¸° ì¤‘</option>
                        <option value="selected">ë‹¹ì²¨</option>
                        <option value="rejected">íƒˆë½</option>
                        <option value="cancelled">ì·¨ì†Œ</option>
                    </select>
                    <button id="update-status-btn" 
                            class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium">
                        ìƒíƒœ ë³€ê²½
                    </button>
                    <button id="delete-application-btn" 
                            class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg font-medium">
                        ì‚­ì œ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- í™•ì¸ ëª¨ë‹¬ -->
    <div id="confirm-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full modal-enter">
            <div class="p-6">
                <div class="flex items-center gap-4 mb-6">
                    <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center">
                        <svg class="w-6 h-6 text-yellow-600" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900" id="confirm-title">í™•ì¸</h3>
                        <p class="text-gray-600" id="confirm-message">ì´ ì‘ì—…ì„ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                    </div>
                </div>
                
                <div class="flex gap-3">
                    <button id="confirm-cancel" 
                            class="flex-1 px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-medium">
                        ì·¨ì†Œ
                    </button>
                    <button id="confirm-ok" 
                            class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium">
                        í™•ì¸
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyC2ddIAkLg8nGAajSlma-GYu_zWeoOVS-0",
            authDomain: "condo-reservation-2025.firebaseapp.com",
            projectId: "condo-reservation-2025",
            storageBucket: "condo-reservation-2025.firebasestorage.app",
            messagingSenderId: "259218005950",
            appId: "1:259218005950:web:35ffb751c686e0c27fe3ef"
        };

        // Firebase ì´ˆê¸°í™”
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // ì „ì—­ ë³€ìˆ˜
        let currentApplications = [];
        let filteredApplications = [];
        let condoChart = null;
        let dateChart = null;
        let selectedApplications = [];
        let currentUser = null;

        // Firebase Auth ìƒíƒœ ë³€í™” ê°ì§€
        auth.onAuthStateChanged((user) => {
            console.log('Auth ìƒíƒœ ë³€í™”:', user ? 'ë¡œê·¸ì¸ë¨' : 'ë¡œê·¸ì•„ì›ƒë¨');
            
            if (user) {
                currentUser = user;
                checkAdminPermission(user);
            } else {
                currentUser = null;
                showLoginScreen();
            }
        });

        // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
        async function checkAdminPermission(user) {
            try {
                console.log('ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ ì¤‘...', user.uid);
                const adminDoc = await db.collection('admins').doc(user.uid).get();
                
                if (adminDoc.exists) {
                    console.log('ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ë¨');
                    document.getElementById('admin-email-display').textContent = adminDoc.data().email;
                    showDashboard();
                } else {
                    console.log('ê´€ë¦¬ì ê¶Œí•œ ì—†ìŒ');
                    showMessage('error', 'ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                    auth.signOut();
                }
            } catch (error) {
                console.error('ê¶Œí•œ í™•ì¸ ì‹¤íŒ¨:', error);
                showMessage('error', 'ê¶Œí•œ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                auth.signOut();
            }
        }

        // ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ
        function showLoginScreen() {
            document.getElementById('loading-screen').classList.add('hidden');
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('admin-dashboard').classList.add('hidden');
        }

        // ëŒ€ì‹œë³´ë“œ í‘œì‹œ
        function showDashboard() {
            document.getElementById('loading-screen').classList.add('hidden');
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('admin-dashboard').classList.remove('hidden');
            initializeDashboard();
        }

        // ê´€ë¦¬ì ê³„ì • ìƒì„±
        async function createAdminAccount() {
            const email = document.getElementById('admin-email').value.trim();
            const password = document.getElementById('admin-password').value.trim();
            
            if (!email || !password) {
                showMessage('error', 'ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (password.length < 6) {
                showMessage('error', 'ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }

            const createBtn = document.getElementById('create-admin-btn');
            const originalText = createBtn.textContent;
            
            try {
                createBtn.disabled = true;
                createBtn.classList.add('btn-loading');
                createBtn.textContent = 'ìƒì„± ì¤‘...';

                // Firebase Auth ê³„ì • ìƒì„±
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Firestoreì— ê´€ë¦¬ì ê¶Œí•œ ì €ì¥
                await db.collection('admins').doc(user.uid).set({
                    email: email,
                    role: 'admin',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                console.log('ê´€ë¦¬ì ê³„ì • ìƒì„± ì™„ë£Œ:', user.uid);
                showMessage('success', 'ê´€ë¦¬ì ê³„ì •ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
                
                // ìë™ìœ¼ë¡œ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™ (onAuthStateChangedì—ì„œ ì²˜ë¦¬ë¨)
                
            } catch (error) {
                console.error('ê³„ì • ìƒì„± ì‹¤íŒ¨:', error);
                
                let errorMessage = 'ê³„ì • ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'ë¹„ë°€ë²ˆí˜¸ê°€ ë„ˆë¬´ ê°„ë‹¨í•©ë‹ˆë‹¤.';
                }
                
                showMessage('error', errorMessage);
            } finally {
                createBtn.disabled = false;
                createBtn.classList.remove('btn-loading');
                createBtn.textContent = originalText;
            }
        }

        // Firebase Auth ê¸°ë°˜ ê´€ë¦¬ì ë¡œê·¸ì¸
        async function adminLogin() {
            const loginBtn = document.getElementById('login-btn');
            const loginText = document.getElementById('login-text');
            const email = document.getElementById('admin-email').value.trim();
            const password = document.getElementById('admin-password').value.trim();
            
            if (!email || !password) {
                showMessage('error', 'ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë¡œë”© ìƒíƒœ
            loginBtn.disabled = true;
            loginBtn.classList.add('btn-loading');
            loginText.textContent = 'ë¡œê·¸ì¸ ì¤‘...';
            
            try {
                console.log('ë¡œê·¸ì¸ ì‹œë„:', email);
                
                // Firebase Auth ë¡œê·¸ì¸
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                console.log('Firebase Auth ë¡œê·¸ì¸ ì„±ê³µ:', user.uid);
                // onAuthStateChangedì—ì„œ í›„ì† ì²˜ë¦¬ ì§„í–‰
                
            } catch (error) {
                console.error('ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
                
                let errorMessage = 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê³„ì •ì…ë‹ˆë‹¤.';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = 'ë„ˆë¬´ ë§ì€ ë¡œê·¸ì¸ ì‹œë„ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                }
                
                showMessage('error', errorMessage);
            } finally {
                loginBtn.disabled = false;
                loginBtn.classList.remove('btn-loading');
                loginText.textContent = 'ë¡œê·¸ì¸';
            }
        }

        // ë¡œê·¸ì•„ì›ƒ
        function adminLogout() {
            auth.signOut().then(() => {
                console.log('ë¡œê·¸ì•„ì›ƒ ì„±ê³µ');
                
                // í¼ ì´ˆê¸°í™”
                document.getElementById('admin-email').value = 'admin@company.com';
                document.getElementById('admin-password').value = '';
                
                showMessage('success', 'ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
            }).catch((error) => {
                console.error('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:', error);
                showMessage('error', 'ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        }

        // Firebase ì—°ê²° ìƒíƒœ í™•ì¸
        function checkFirebaseConnection() {
            console.log('ğŸ”¥ Firebase ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...');
            
            if (!firebase.apps.length) {
                console.error('âŒ Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                updateFirebaseStatus(false);
                return false;
            }
            
            console.log('âœ… Firebase ì´ˆê¸°í™” í™•ì¸ë¨');
            updateFirebaseStatus(true);
            return true;
        }

        // Firebase ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateFirebaseStatus(isConnected) {
            const indicator = document.getElementById('firebase-status-indicator');
            if (!indicator) return;
            
            if (isConnected) {
                indicator.innerHTML = `
                    <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                    <span class="text-blue-100">Firebase ì—°ê²°ë¨</span>
                `;
            } else {
                indicator.innerHTML = `
                    <div class="w-2 h-2 bg-red-400 rounded-full"></div>
                    <span class="text-blue-100">Firebase ì—°ê²° ì‹¤íŒ¨</span>
                `;
            }
        }

        // ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”
        async function initializeDashboard() {
            console.log('ğŸ“Š ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì‹œì‘...');
            
            if (!checkFirebaseConnection()) {
                showMessage('error', 'Firebase ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            console.log('â° ì‹œê°„ ì—…ë°ì´íŠ¸ ì„¤ì • ì™„ë£Œ');
            
            await loadApplications();
            console.log('ğŸ“‹ ì‹ ì²­ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
            
            updateStatistics();
            console.log('ğŸ“ˆ í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
            
            createCharts();
            console.log('ğŸ“Š ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
            
            setupEventListeners();
            console.log('ğŸ¯ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ');
            
            console.log('âœ… ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì™„ë£Œ!');
        }

        // í˜„ì¬ ì‹œê°„ ì—…ë°ì´íŠ¸
        function updateCurrentTime() {
            const now = new Date();
            const timeElement = document.getElementById('current-time');
            if (timeElement) {
                timeElement.textContent = 
                    now.toLocaleString('ko-KR', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
            }
        }

        // ì‹ ì²­ ë°ì´í„° ë¡œë“œ
        async function loadApplications() {
            try {
                console.log('ğŸ”„ Firebaseì—ì„œ ì‹ ì²­ ë°ì´í„° ë¡œë“œ ì¤‘...');
                const snapshot = await db.collection('applications').orderBy('createdAt', 'desc').get();
                currentApplications = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                filteredApplications = [...currentApplications];
                renderApplicationsTable();
                console.log('âœ… ì‹ ì²­ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', currentApplications.length, 'ê±´');
                
                if (currentApplications.length === 0) {
                    console.log('âš ï¸ ì‹ ì²­ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì‚¬ìš©ìê°€ ì‹ ì²­ì„ í•´ì£¼ì„¸ìš”.');
                }
            } catch (error) {
                console.error('âŒ ì‹ ì²­ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                showMessage('error', 'Firebase ë°ì´í„° ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStatistics() {
            const stats = {
                total: currentApplications.length,
                selected: currentApplications.filter(app => app.status === 'selected').length,
                pending: currentApplications.filter(app => app.status === 'pending').length,
                rejected: currentApplications.filter(app => app.status === 'rejected').length
            };

            document.getElementById('total-applications').textContent = stats.total;
            document.getElementById('selected-applications').textContent = stats.selected;
            document.getElementById('pending-applications').textContent = stats.pending;
            document.getElementById('rejected-applications').textContent = stats.rejected;
        }

        // ì°¨íŠ¸ ìƒì„±
        function createCharts() {
            // ì½˜ë„ë³„ ì°¨íŠ¸
            const condoData = {};
            currentApplications.forEach(app => {
                const condo = app.condoName || 'ì•Œ ìˆ˜ ì—†ìŒ';
                condoData[condo] = (condoData[condo] || 0) + 1;
            });

            const condoCtx = document.getElementById('condoChart').getContext('2d');
            if (condoChart) condoChart.destroy();
            condoChart = new Chart(condoCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(condoData),
                    datasets: [{
                        data: Object.values(condoData),
                        backgroundColor: [
                            '#3B82F6', '#10B981', '#F59E0B', '#EF4444',
                            '#8B5CF6', '#06B6D4', '#84CC16', '#F97316'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // ì¼ë³„ ì°¨íŠ¸
            const dateData = {};
            currentApplications.forEach(app => {
                if (app.createdAt) {
                    const date = app.createdAt.toDate().toDateString();
                    dateData[date] = (dateData[date] || 0) + 1;
                }
            });

            const dateCtx = document.getElementById('dateChart').getContext('2d');
            if (dateChart) dateChart.destroy();
            dateChart = new Chart(dateCtx, {
                type: 'line',
                data: {
                    labels: Object.keys(dateData).slice(-7),
                    datasets: [{
                        label: 'ì¼ë³„ ì‹ ì²­ ìˆ˜',
                        data: Object.values(dateData).slice(-7),
                        borderColor: '#3B82F6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // ì‹ ì²­ í…Œì´ë¸” ë Œë”ë§
        function renderApplicationsTable() {
            const tbody = document.getElementById('applications-table');
            tbody.innerHTML = '';

            if (filteredApplications.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-12 text-center text-gray-500">
                            ì‹ ì²­ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                `;
                return;
            }

            filteredApplications.forEach(app => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-100';
                row.innerHTML = `
                    <td class="px-6 py-4">
                        <input type="checkbox" class="application-checkbox rounded" data-id="${app.id}">
                    </td>
                    <td class="px-6 py-4">
                        <div class="font-medium text-gray-900">${app.name}</div>
                        <div class="text-sm text-gray-500">${app.employeeId}</div>
                        <div class="text-sm text-gray-500">${app.phone}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="font-medium">${app.condoName}</div>
                        <div class="text-sm text-gray-500">${app.condoType}</div>
                    </td>
                    <td class="px-6 py-4 text-sm">
                        ${app.condoDates || app.condoDate}
                    </td>
                    <td class="px-6 py-4">
                        <span class="status-badge status-${app.status}">
                            ${getStatusText(app.status)}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-500">
                        ${app.createdAt ? app.createdAt.toDate().toLocaleDateString('ko-KR') : ''}
                    </td>
                    <td class="px-6 py-4">
                        <button class="text-blue-600 hover:text-blue-800 font-medium text-sm" 
                                onclick="showApplicationDetail('${app.id}')">
                            ìƒì„¸ë³´ê¸°
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            setupCheckboxEvents();
        }

        // ìƒíƒœ í…ìŠ¤íŠ¸ ë°˜í™˜
        function getStatusText(status) {
            const statusMap = {
                pending: 'ëŒ€ê¸° ì¤‘',
                selected: 'ë‹¹ì²¨',
                rejected: 'íƒˆë½',
                cancelled: 'ì·¨ì†Œ'
            };
            return statusMap[status] || 'ì•Œ ìˆ˜ ì—†ìŒ';
        }

        // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ì„¤ì •
        function setupCheckboxEvents() {
            // ì „ì²´ ì„ íƒ
            const selectAllCheckbox = document.getElementById('select-all');
            if (selectAllCheckbox) {
                selectAllCheckbox.addEventListener('change', function() {
                    const checkboxes = document.querySelectorAll('.application-checkbox');
                    checkboxes.forEach(cb => {
                        cb.checked = this.checked;
                    });
                    updateSelectedApplications();
                });
            }

            // ê°œë³„ ì²´í¬ë°•ìŠ¤
            document.querySelectorAll('.application-checkbox').forEach(cb => {
                cb.addEventListener('change', updateSelectedApplications);
            });
        }

        // ì„ íƒëœ ì‹ ì²­ ì—…ë°ì´íŠ¸
        function updateSelectedApplications() {
            selectedApplications = Array.from(document.querySelectorAll('.application-checkbox:checked'))
                .map(cb => cb.dataset.id);
            
            const bulkActions = document.getElementById('bulk-actions');
            if (selectedApplications.length > 0) {
                bulkActions.classList.remove('hidden');
            } else {
                bulkActions.classList.add('hidden');
            }
        }

        // ì‹ ì²­ ìƒì„¸ ì •ë³´ í‘œì‹œ
        function showApplicationDetail(id) {
            const app = currentApplications.find(a => a.id === id);
            if (!app) return;

            const content = document.getElementById('detail-content');
            content.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ì„±ëª…</label>
                        <p class="text-gray-900 font-semibold">${app.name}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ì‚¬ë²ˆ</label>
                        <p class="text-gray-900">${app.employeeId}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ì—°ë½ì²˜</label>
                        <p class="text-gray-900">${app.phone}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ì‹ ì²­ì¼</label>
                        <p class="text-gray-900">${app.createdAt ? app.createdAt.toDate().toLocaleString('ko-KR') : ''}</p>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">ì½˜ë„ëª…</label>
                        <p class="text-gray-900 font-semibold">${app.condoName}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">í‰í˜•</label>
                        <p class="text-gray-900">${app.condoType}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ì˜ˆì•½ì¼ì</label>
                        <p class="text-gray-900">${app.condoDates || app.condoDate}</p>
                    </div>
                    ${app.condoNote ? `
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">ìœ ì˜ì‚¬í•­</label>
                            <p class="text-yellow-700 bg-yellow-100 p-2 rounded">${app.condoNote}</p>
                        </div>
                    ` : ''}
                </div>
            `;

            document.getElementById('detail-status').value = app.status;
            document.getElementById('detail-modal').classList.remove('hidden');
            
            document.getElementById('detail-modal').dataset.applicationId = id;
        }

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        async function updateApplicationStatus(id, newStatus) {
            try {
                await db.collection('applications').doc(id).update({
                    status: newStatus,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                const app = currentApplications.find(a => a.id === id);
                if (app) {
                    app.status = newStatus;
                }
                
                renderApplicationsTable();
                updateStatistics();
                createCharts();
                showMessage('success', 'ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                showMessage('error', 'ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì‹ ì²­ ì‚­ì œ
        async function deleteApplication(id) {
            try {
                await db.collection('applications').doc(id).delete();
                
                currentApplications = currentApplications.filter(a => a.id !== id);
                filteredApplications = filteredApplications.filter(a => a.id !== id);
                
                renderApplicationsTable();
                updateStatistics();
                createCharts();
                showMessage('success', 'ì‹ ì²­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ì‹ ì²­ ì‚­ì œ ì‹¤íŒ¨:', error);
                showMessage('error', 'ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ìë™ ì¶”ì²¨
        async function runAutoDraw() {
            const pendingApps = currentApplications.filter(app => app.status === 'pending');
            
            if (pendingApps.length === 0) {
                showMessage('error', 'ì¶”ì²¨í•  ëŒ€ê¸° ì¤‘ì¸ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const condoGroups = {};
            pendingApps.forEach(app => {
                const key = `${app.condoName}_${app.condoDate}`;
                if (!condoGroups[key]) {
                    condoGroups[key] = [];
                }
                condoGroups[key].push(app);
            });

            try {
                for (const [condoKey, apps] of Object.entries(condoGroups)) {
                    if (apps.length > 0) {
                        const winnerIndex = Math.floor(Math.random() * apps.length);
                        const winner = apps[winnerIndex];
                        
                        await updateApplicationStatus(winner.id, 'selected');
                        
                        for (let i = 0; i < apps.length; i++) {
                            if (i !== winnerIndex) {
                                await updateApplicationStatus(apps[i].id, 'rejected');
                            }
                        }
                    }
                }
                
                await loadApplications();
                updateStatistics();
                createCharts();
                showMessage('success', 'ìë™ ì¶”ì²¨ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (error) {
                console.error('ìë™ ì¶”ì²¨ ì‹¤íŒ¨:', error);
                showMessage('error', 'ì¶”ì²¨ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì¶”ì²¨ ê²°ê³¼ ì´ˆê¸°í™”
        async function resetDraw() {
            try {
                const batch = db.batch();
                currentApplications.forEach(app => {
                    if (app.status === 'selected' || app.status === 'rejected') {
                        const ref = db.collection('applications').doc(app.id);
                        batch.update(ref, { status: 'pending' });
                    }
                });
                
                await batch.commit();
                await loadApplications();
                updateStatistics();
                createCharts();
                showMessage('success', 'ì¶”ì²¨ ê²°ê³¼ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ì¶”ì²¨ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                showMessage('error', 'ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // Excel ë‚´ë³´ë‚´ê¸°
        function exportToExcel() {
            let csvContent = "ì„±ëª…,ì‚¬ë²ˆ,ì—°ë½ì²˜,ì½˜ë„ëª…,í‰í˜•,ì˜ˆì•½ì¼ì,ìƒíƒœ,ì‹ ì²­ì¼\n";
            
            currentApplications.forEach(app => {
                const row = [
                    app.name,
                    app.employeeId,
                    app.phone,
                    app.condoName,
                    app.condoType,
                    app.condoDates || app.condoDate,
                    getStatusText(app.status),
                    app.createdAt ? app.createdAt.toDate().toLocaleDateString('ko-KR') : ''
                ].join(',');
                csvContent += row + "\n";
            });

            const blob = new Blob(["\ufeff" + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.setAttribute("href", URL.createObjectURL(blob));
            link.setAttribute("download", `ì½˜ë„ì˜ˆì•½ì‹ ì²­_${new Date().toISOString().split('T')[0]}.csv`);
            link.click();
            
            showMessage('success', 'Excel íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ë°ì´í„° ë°±ì—…
        async function backupData() {
            try {
                const snapshot = await db.collection('applications').get();
                const data = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                const blob = new Blob([JSON.stringify(data, null, 2)], {
                    type: 'application/json'
                });
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `backup_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                
                console.log('ë°±ì—… ì™„ë£Œ:', data.length, 'ê±´');
                showMessage('success', `ë°ì´í„° ë°±ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. (${data.length}ê±´)`);
            } catch (error) {
                console.error('ë°±ì—… ì‹¤íŒ¨:', error);
                showMessage('error', 'ë°±ì—…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ê²€ìƒ‰ ë° í•„í„°ë§
        function filterApplications() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const statusFilter = document.getElementById('status-filter').value;

            filteredApplications = currentApplications.filter(app => {
                const matchesSearch = 
                    app.name.toLowerCase().includes(searchTerm) ||
                    app.employeeId.includes(searchTerm) ||
                    (app.condoName && app.condoName.toLowerCase().includes(searchTerm));
                
                const matchesStatus = !statusFilter || app.status === statusFilter;
                
                return matchesSearch && matchesStatus;
            });

            renderApplicationsTable();
        }

        // ì¼ê´„ ìƒíƒœ ë³€ê²½
        async function bulkUpdateStatus(newStatus) {
            if (selectedApplications.length === 0) {
                showMessage('error', 'ì„ íƒëœ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            try {
                const batch = db.batch();
                selectedApplications.forEach(id => {
                    const ref = db.collection('applications').doc(id);
                    batch.update(ref, { 
                        status: newStatus,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                });
                
                await batch.commit();
                await loadApplications();
                updateStatistics();
                createCharts();
                showMessage('success', `${selectedApplications.length}ê±´ì˜ ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                
                document.getElementById('select-all').checked = false;
                updateSelectedApplications();
            } catch (error) {
                console.error('ì¼ê´„ ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨:', error);
                showMessage('error', 'ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
        function showConfirmModal(title, message, callback) {
            document.getElementById('confirm-title').textContent = title;
            document.getElementById('confirm-message').textContent = message;
            document.getElementById('confirm-modal').classList.remove('hidden');
            
            document.getElementById('confirm-ok').onclick = () => {
                hideConfirmModal();
                callback();
            };
        }

        // í™•ì¸ ëª¨ë‹¬ ìˆ¨ê¸°ê¸°
        function hideConfirmModal() {
            document.getElementById('confirm-modal').classList.add('hidden');
        }

        // ë©”ì‹œì§€ í‘œì‹œ (ë¡œê·¸ì¸ í™”ë©´ê³¼ ëŒ€ì‹œë³´ë“œ ëª¨ë‘ ì§€ì›)
        function showMessage(type, message) {
            const isLoginScreen = !document.getElementById('login-screen').classList.contains('hidden');
            
            if (isLoginScreen) {
                const element = document.getElementById(`login-${type}`);
                const textElement = document.getElementById(`login-${type}-text`);
                
                if (element && textElement) {
                    textElement.textContent = message;
                    element.classList.remove('hidden');
                    setTimeout(() => element.classList.add('hidden'), 5000);
                }
            } else {
                const element = document.getElementById(`admin-${type}`);
                const textElement = document.getElementById(`admin-${type}-text`);
                
                if (element && textElement) {
                    textElement.textContent = message;
                    element.classList.remove('hidden');
                    setTimeout(() => element.classList.add('hidden'), 5000);
                }
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • (ëŒ€ì‹œë³´ë“œìš©)
        function setupEventListeners() {
            // ë¡œê·¸ì•„ì›ƒ
            document.getElementById('logout-btn').addEventListener('click', adminLogout);

            // ê²€ìƒ‰ ë° í•„í„°
            document.getElementById('search-input').addEventListener('input', filterApplications);
            document.getElementById('status-filter').addEventListener('change', filterApplications);

            // ì¶”ì²¨ ê´€ë¦¬
            document.getElementById('auto-draw-btn').addEventListener('click', () => {
                showConfirmModal('ìë™ ì¶”ì²¨', 'ìë™ ì¶”ì²¨ì„ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', runAutoDraw);
            });
            
            document.getElementById('reset-draw-btn').addEventListener('click', () => {
                showConfirmModal('ì¶”ì²¨ ì´ˆê¸°í™”', 'ëª¨ë“  ì¶”ì²¨ ê²°ê³¼ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', resetDraw);
            });
            
            document.getElementById('export-btn').addEventListener('click', exportToExcel);
            document.getElementById('backup-btn').addEventListener('click', backupData);

            // ëª¨ë‹¬ ê´€ë ¨
            document.getElementById('detail-modal-close').addEventListener('click', () => {
                document.getElementById('detail-modal').classList.add('hidden');
            });

            document.getElementById('update-status-btn').addEventListener('click', () => {
                const id = document.getElementById('detail-modal').dataset.applicationId;
                const newStatus = document.getElementById('detail-status').value;
                updateApplicationStatus(id, newStatus);
                document.getElementById('detail-modal').classList.add('hidden');
            });

            document.getElementById('delete-application-btn').addEventListener('click', () => {
                const id = document.getElementById('detail-modal').dataset.applicationId;
                showConfirmModal('ì‹ ì²­ ì‚­ì œ', 'ì´ ì‹ ì²­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', () => {
                    deleteApplication(id);
                    document.getElementById('detail-modal').classList.add('hidden');
                });
            });

            document.getElementById('confirm-cancel').addEventListener('click', hideConfirmModal);

            // ì¼ê´„ ì•¡ì…˜
            document.querySelectorAll('.bulk-action-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const action = e.target.dataset.action;
                    showConfirmModal(
                        'ì¼ê´„ ì²˜ë¦¬', 
                        `ì„ íƒí•œ ${selectedApplications.length}ê±´ì˜ ì‹ ì²­ì„ ${getStatusText(action)} ìƒíƒœë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`,
                        () => bulkUpdateStatus(action)
                    );
                });
            });
        }

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
        window.showApplicationDetail = showApplicationDetail;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ë¡œë“œ ì™„ë£Œ');
            
            // Firebase ì´ˆê¸°í™” í™•ì¸
            setTimeout(() => {
                if (firebase.apps.length === 0) {
                    console.error('âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨');
                    showMessage('error', 'Firebase ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.');
                } else {
                    console.log('âœ… Firebase ì´ˆê¸°í™” ì„±ê³µ');
                }
            }, 1000);
            
            // ë¡œê·¸ì¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            document.getElementById('login-btn').addEventListener('click', () => {
                console.log('ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­ë¨');
                adminLogin();
            });
            
            document.getElementById('create-admin-btn').addEventListener('click', () => {
                console.log('ê´€ë¦¬ì ê³„ì • ìƒì„± ë²„íŠ¼ í´ë¦­ë¨');
                createAdminAccount();
            });
            
            document.getElementById('admin-password').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    console.log('ë¹„ë°€ë²ˆí˜¸ í•„ë“œì—ì„œ Enter í‚¤ ì…ë ¥');
                    adminLogin();
                }
            });
            
            document.getElementById('admin-email').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    console.log('ì´ë©”ì¼ í•„ë“œì—ì„œ Enter í‚¤ ì…ë ¥');
                    adminLogin();
                }
            });
            
            console.log('âœ… ë¡œê·¸ì¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ');
        });
    </script>
</body>
</html>